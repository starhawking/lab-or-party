- hosts: openstack-hosts
  tasks:
    - name: Add Ubuntu Cloud Keyring
      apt:
        name: ubuntu-cloud-keyring
        state: present

    - name: Add Ubuntu Cloud Archive Newton PPA
      apt_repository:
        repo: "deb http://ubuntu-cloud.archive.canonical.com/ubuntu xenial-updates/newton main"
        state: present

    - name: Add Keystone Packages
      apt: update_cache=yes state=present name="{{ item }}"
      with_items:
        - python-keystone
        - keystone
        - python-keystoneclient
        - python-openstackclient

    - name: Add Keystone Config
      file: src=files/keystone/keystone.conf dest=/etc/keystone/keystone.conf

    - name: Restart Apache for Glance
      service:
        name: apache2
        state: restarted

    - name: Add Glance Packages
      apt: update_cache=yes state=present name="{{ item }}"
      with_items:
        - python-glance
        - glance
        - python-glanceclient
